#!/bin/bash
configure=""
debug="-d"
target="0.28.2"
arch=""
dist="https://atom.io/download/atom-shell"
plat=`uname`

if [ $plat == 'Linux' ] || [ $plat == 'Darwin' ]; then
  msvs=""
else
  msvs="--msvs_version=2013"
fi

while [[ $# > 0 ]]
do
key="$1"
case $key in
    # configure
    -c|--configure|configure)
    configure="configure"
    ;;

    #debug
    -r|--release|release)
    debug=""
    ;;

    -d|--debug|debug)
    debug="-d" # default
    ;;

    -t|--target)
    target="$2"
    shift
    ;;

    -D|--dist|--dist-url)
    dist="$2"
    shift
    ;;

    --msvs)
    msvs="$2"
    shift
    ;;

    #arch
    -x86|x86)
    arch="--arch=ia32"
    ;;
    -x64|x64)
    arch="" # default
    ;;

    # unknown option
    *) 
    echo "Unknown option: $i"
    exit 1
    ;;
esac
shift
done

if [ "$NPM_CONFIG_PREFIX" != "" ] && [ -f "${NPM_CONFIG_PREFIX}/node-gyp" ]; then
    # prefer globally installed node-gyp during "npm install"
    command=${NPM_CONFIG_PREFIX}/node-gyp
else
    command=`which node-gyp`
fi

#env
#echo $command
#exit 0

HOME=~/.electron-gyp "${command}" --target="${target}" ${msvs} ${arch} ${debug} --dist-url=${dist} ${configure} build